cmake_minimum_required(VERSION 2.7)

set(MODEL_NAME sine)
set(MODEL_SRC fwdmodel_${MODEL_NAME}.cc fwdmodel_${MODEL_NAME}_lib.cc)

set(LIB_NAME fabber_model_${MODEL_NAME})
add_library(${LIB_NAME} SHARED ${MODEL_SRC})

if(APPLE)
  # Force use of libstdc++ on Mac as FSL uses this and we cannot link otherwise
  set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -std=c++11 -stdlib=libstdc++")
endif(APPLE)

find_path(FABBER_INCLUDE_DIR fabber_core/fwdmodel.h
            HINTS ../..  .. $ENV{FSLDIR}/include REQUIRED)
find_path(NEWMAT_INCLUDE_DIR newmat.h
            HINTS $ENV{FSLDIR}/extras/include/newmat REQUIRED)
find_path(FSL_INCLUDE_DIR newimage/newimage.h
            HINTS $ENV{FSLDIR}/include REQUIRED)
find_path(FSL_EXT_INCLUDE_DIR libprob/libprob.h
            HINTS $ENV{FSLDIR}/extras/include REQUIRED)
find_path(BOOST_INCLUDE_DIR boost/shared_ptr.hpp
          HINTS $ENV{FSLDIR}/extras/include/boost $ENV{FSLDIR}/extras/include/ REQUIRED)
find_library(PROB_LIBRARY NAMES prob libprob
             HINTS $ENV{FSLDIR}/extras/lib REQUIRED )

Message("-- FSL headers in ${FSL_INCLUDE_DIR} ${NEWMAT_INCLUDE_DIR} ${FSL_EXT_INCLUDE_DIR} ${BOOST_INCLUDE_DIR}")
Message("-- Fabber headers in ${FABBER_INCLUDE_DIR}/fabber_core")

find_library(FABBER_LIBRARY NAMES fabbercore libfabbercore
             HINTS ../Release ../Debug $ENV{FSLDIR}/lib REQUIRED )
find_library(NEWMAT_LIBRARY NAMES newmat libnewmat
             HINTS $ENV{FSLDIR}/extras/lib REQUIRED )
find_library(MISCMATHS_LIBRARY NAMES miscmaths libmiscmaths
             HINTS $ENV{FSLDIR}/lib REQUIRED )
find_library(UTILS_LIBRARY NAMES utils libutils
             HINTS $ENV{FSLDIR}/lib REQUIRED )
find_library(NIFTIIO_LIBRARY NAMES niftiio libniftiio
             HINTS $ENV{FSLDIR}/lib REQUIRED )
find_library(ZNZ_LIBRARY NAMES znz libznz
             HINTS $ENV{FSLDIR}/lib REQUIRED )
find_library(Z_LIBRARY NAMES z libz zlib zlibd 
               HINTS $ENV{FSLDIR}/lib REQUIRED )

Message("-- Using libznz: ${ZNZ_LIBRARY}")
Message("-- Using libutils: ${UTILS_LIBRARY} ${UTILS_INCLUDE_DIR}")
Message("-- Using miscmaths: ${MISCMATHS_LIBRARY}")
Message("-- Using fslio: ${FSLIO_LIBRARY}")
Message("-- Using niftiio: ${NIFTIIO_LIBRARY}")
Message("-- Using newmat: ${NEWMAT_LIBRARY} ${NEWMAT_INCLUDE_DIR}")
Message("-- Using newimage: ${NEWIMAGE_LIBRARY}")
Message("-- Using zlib: ${ZLIB_LIBRARY}")

target_link_libraries(${LIB_NAME} ${FABBER_LIBRARY} ${MISCMATHS_LIBRARY} ${UTILS_LIBRARY} ${NIFTIIO_LIBRARY} ${ZNZ_LIBRARY}  ${NEWMAT_LIBRARY} ${Z_LIBRARY})

include_directories(SYSTEM ${FABBER_INCLUDE_DIR} ${NEWMAT_INCLUDE_DIR} ${FSL_INCLUDE_DIR} ${FSL_EXT_INCLUDE_DIR} ${BOOST_INCLUDE_DIR})

